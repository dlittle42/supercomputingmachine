function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}$(document).ready(function(){function a(a){var b='<ul id="job_list">';$.each(a.issues,function(a,c){console.log(a+" - <<<< "+c.key),b+='<li class="cl-effect-2"><a class="job" href="'+c.self+'" job="'+c.key+'"><span data-hover="'+c.key+": "+c.fields.summary+'">'+c.key+": "+c.fields.summary+"</span></a></li>"}),b+="</ul>",$("#issues").html(b),o("Complete.")}function b(){console.log(localStorage.getItem("username"));var a=localStorage.getItem("username");a&&$("#username").val(a);var b=localStorage.getItem("password");b&&$("#password").val(b)}function c(){document[I]?(K=!1,speak.play("this window is hidden",{pitch:getRandomInt(40,100),speed:150},function(){console.log("completed!")})):(speak.play("this window is front and center",{pitch:getRandomInt(40,100),speed:150},function(){console.log("completed!")}),K=!0)}function d(){document.addEventListener("headtrackrStatus",function(a){if(a.status in supportMessages){var b=document.getElementById("gUMMessage");b.innerHTML=supportMessages[a.status],C!=supportMessages[a.status]&&(e(supportMessages[a.status]),C=supportMessages[a.status])}else if(a.status in statusMessages){var b=document.getElementById("headtrackerMessage");b.innerHTML=statusMessages[a.status],B!=statusMessages[a.status]&&(e(statusMessages[a.status]),B=statusMessages[a.status],console.log(statusMessages[a.status]),"Tracking face"==statusMessages[a.status]?(D="green",r&&$(".numbers").css("-webkit-animation-play-state","running")):(D="red",r&&$(".numbers").css("-webkit-animation-play-state","paused")))}},!0);var a=new headtrackr.Tracker({altVideo:{ogv:"./media/capture5.ogv",mp4:"./media/capture5.mp4"},calcAngles:!0,ui:!1,headPosition:!1,debug:x});a.init(t,u),a.start(),e("Hello. Starting presence detection."),h(),f(),$("#headline").fadeOut("slow",function(){var a="Activate media...";$(this).text(a).fadeIn("slow"),o("Detecting user presence.")}),document.addEventListener("facetrackingEvent",function(a){y.clearRect(0,0,document.width,document.height),"CS"==a.detection&&(y.translate(a.x,a.y),y.rotate(a.angle-Math.PI/2),y.strokeStyle="#00CC00",y.strokeRect(-(a.width/2)>>0,-(a.height/2)>>0,a.width,a.height),y.rotate(Math.PI/2-a.angle),y.translate(-a.x,-a.y))})}function e(a){K&&speak.play(a,{pitch:getRandomInt(40,100),speed:150},function(){console.log("completed!")})}function f(){requestAnimationFrame(f),imageData=v.getImageData(0,0,320,240),imageData.data=g(imageData.data),A.putImageData(imageData,0,0),A.translate(320,0),A.scale(-1,1)}function g(a){for(var b=0,c=a.length;c>b;b+=4)switch(D){case"red":a[b+1]=0,a[b+2]=0;break;case"green":a[b]=0,a[b+2]=0;break;case"invert":a[b]=255-a[b],a[b+1]=255-a[b+1],a[b+2]=255-a[b+2];break;case"redtransparent":a[b]>127&&(a[b+3]=127)}return a}function h(){console.log("setupWebSpeech"),n("info_start");var a,b,c="";"webkitSpeechRecognition"in window?(start_button.style.display="inline-block",H.continuous=!0,H.interimResults=!0,H.lang="en_US",m(),H.onstart=function(){G=!0,n("info_speak_now"),$("#headline").fadeOut("slow",function(){var a="Select project.";$(this).text(a).fadeIn("slow"),o(a)}),start_img.src="images/mic-animate.gif"},H.onerror=function(c){"no-speech"==c.error&&(start_img.src="images/mic.gif",n("info_no_speech"),a=!0),"audio-capture"==c.error&&(start_img.src="images/mic.gif",n("info_no_microphone"),a=!0),"not-allowed"==c.error&&(c.timeStamp-b<100?n("info_blocked"):n("info_denied"),a=!0)},H.onend=function(){return G=!1,a?void 0:(start_img.src="images/mic.gif",c?(n(""),void 0):(n("info_again"),void 0))},H.onresult=function(a){for(var b="",c=a.resultIndex;c<a.results.length;++c)a.results[c].isFinal?i(a.results[c][0].transcript):b+=a.results[c][0].transcript}):l()}function i(a){console.log(a),"start timer"==a.trim()?j():"stop timer"==a.trim()&&k(),$("#headline").text(a.toLowerCase()),o(a)}function j(){E!=F&&(p=(new Date).getTime(),F=E,console.log("start_timestamp="+p)),$(".numbers").css("-webkit-animation-play-state","running"),r=!0,console.log("start")}function k(){E==F&&(q=(new Date).getTime(),console.log("end_timestamp="+q)),r=!1,$(".numbers").css("-webkit-animation-play-state","paused"),console.log("stop")}function l(){start_button.style.visibility="hidden",n("info_upgrade")}function m(){return console.log("startButton"),G?(H.stop(),void 0):(final_transcript="",H.start(),ignore_onend=!1,start_img.src="images/mic-slash.gif",n("info_allow"),p=(new Date).getTime(),void 0)}function n(a){if(a){for(var b=info.firstChild;b;b=b.nextSibling)b.style&&(b.style.display=b.id==a?"inline":"none");info.style.visibility="visible"}else info.style.visibility="hidden"}function o(a){speak.play(a,{pitch:100,speed:150},function(){console.log("play!")},function(){console.log("completed!")})}var p,q,r,s="http://jira.nodejitsu.com/issues",t=document.getElementById("vid"),u=document.getElementById("compare"),v=u.getContext("2d"),w=document.getElementById("overlay"),x=document.getElementById("debug"),y=w.getContext("2d"),z=document.getElementById("feed"),A=z.getContext("2d"),B=null,C=null,D="red",E="",F="",G=!1,H=new webkitSpeechRecognition;b(),d(),$("#loginBtn").click(function(b){b.preventDefault();var c=$("#username").val(),d=$("#password").val();localStorage.setItem("username",c),localStorage.setItem("password",d),$.ajax({type:"POST",cache:!1,url:s,data:{name:c,pass:d},beforeSend:function(){o("Retrieving jobs.")}}).done(function(b){$("#Jira_login").fadeOut(),console.log(b),setTimeout(a,1e3,b)}).fail(function(a,b){alert(a),console.log(b)})}),$("#logwork").click(function(a){a.preventDefault(),k();var b=$("#username").val(),c=$("#password").val(),d=Math.floor((q-p)/1e3);console.log("logtime="+d),console.log("logtime="+typeof d),60>d&&(d=60),$.ajax({type:"POST",cache:!1,url:"http://jira.nodejitsu.com/logwork",data:{name:b,pass:c,job:"TNII-4",seconds:d},beforeSend:function(){o("Logging time.")}}).done(function(a){o("Complete."),console.log(a)}).fail(function(a,b){alert(a),console.log(b)})}),$(document).on("click",".job",function(a){a.preventDefault(),E=$(this).attr("job"),console.log(E),$("#logwork").fadeIn(),$("#headline").fadeOut("slow",function(){var a=E;$(this).text(a).fadeIn("slow"),o("Selected "+E)})});var I,J,K=!0;"undefined"!=typeof document.hidden?(I="hidden",J="visibilitychange"):"undefined"!=typeof document.mozHidden?(I="mozHidden",J="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(I="msHidden",J="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(I="webkitHidden",J="webkitvisibilitychange"),"undefined"==typeof document.addEventListener||"undefined"==typeof I?alert("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(J,c,!1),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}),statusMessages={whitebalance:"checking for stability of camera whitebalance",detecting:"Searching for face",hints:"Hmm. Detecting the face is taking a long time",redetecting:"Lost track of face, redetecting",lost:"Lost track of face",found:"Tracking face"},supportMessages={"no getUserMedia":"Unfortunately, <a href='http://dev.w3.org/2011/webrtc/editor/getusermedia.html'>getUserMedia</a> is not supported in your browser. Try <a href='http://www.opera.com/browser/'>downloading Opera 12</a> or <a href='http://caniuse.com/stream'>another browser that supports getUserMedia</a>. Now using fallback video for facedetection.","no camera":"No camera found. Using fallback video for facedetection."},$("body").keydown(function(a){87===a.which&&a.shiftKey&&($("#debug_panel").hasClass("animate")?$("#debug_panel").removeClass("animate"):$("#debug_panel").addClass("animate"))}),$(document).on("click","#reactivate_speech",function(){m()})});